# 南意秋棠域名访问配置说明

## 🌐 域名访问地址

### 前端访问
- **域名访问**: http://chenxiaoshivivid.com.cn:8500
- **IP访问**: http://121.36.205.70:8500

### 后端API访问
- **域名访问**: http://chenxiaoshivivid.com.cn:5001
- **IP访问**: http://121.36.205.70:5001

## 🔧 配置修改

### 1. 前端服务器配置 (`frontend/server.py`)
```python
# 默认域名配置
domain = os.environ.get('DOMAIN', 'chenxiaoshivivid.com.cn')
backend_url = os.environ.get('BACKEND_URL', 'http://121.36.205.70:5001')
```

### 2. 后端服务器配置 (`backend/app.py`)
```python
# 默认域名配置
domain = os.environ.get('DOMAIN', 'chenxiaoshivivid.com.cn')
```

## 🚨 端口占用问题解决

### 问题现象
- 系统服务不断重启
- 错误信息：`OSError: [Errno 98] Address already in use`

### 解决方案

#### 1. 使用强制清理脚本
```bash
cd /opt/hanfu/products
sudo bash force-cleanup.sh
```

#### 2. 重新安装系统服务
```bash
# 卸载旧服务
sudo bash service-manager.sh uninstall

# 重新安装服务
sudo bash service-manager.sh install
```

#### 3. 手动启动服务
```bash
# 如果系统服务有问题，可以使用手动启动
./start_services.sh
```

## 🔍 故障排除

### 检查端口占用
```bash
# 检查5001端口
lsof -i :5001

# 检查8500端口
lsof -i :8500

# 检查所有相关进程
ps aux | grep python
```

### 强制清理端口
```bash
# 杀死占用5001端口的进程
lsof -ti:5001 | xargs kill -9

# 杀死占用8500端口的进程
lsof -ti:8500 | xargs kill -9

# 杀死所有相关Python进程
pkill -f "python.*app.py"
pkill -f "python.*server.py"
```

### 查看服务状态
```bash
# 查看系统服务状态
systemctl status nanyi-backend nanyi-frontend

# 查看服务日志
journalctl -u nanyi-backend -f
journalctl -u nanyi-frontend -f
```

## 🌟 DNS配置建议

### 如果域名解析有问题，请检查：

1. **DNS记录配置**
   ```
   A记录: chenxiaoshivivid.com.cn -> 121.36.205.70
   ```

2. **防火墙设置**
   ```bash
   # 开放端口
   firewall-cmd --permanent --add-port=5001/tcp
   firewall-cmd --permanent --add-port=8500/tcp
   firewall-cmd --reload
   ```

3. **安全组配置**
   - 确保云服务器安全组开放了5001和8500端口

## 📱 访问测试

### 测试步骤
1. 确保服务正常运行
2. 在浏览器中访问：http://chenxiaoshivivid.com.cn:8500
3. 如果域名访问失败，尝试IP访问：http://121.36.205.70:8500

### 预期结果
- 页面正常加载
- 可以看到汉服布料设计展示
- 筛选和搜索功能正常
- 图片预览和下载功能正常

## 🎯 推荐部署方式

### 生产环境推荐
```bash
# 1. 强制清理
sudo bash force-cleanup.sh

# 2. 安装系统服务
sudo bash install-service.sh

# 3. 验证服务状态
systemctl status nanyi-backend nanyi-frontend
```

### 开发环境推荐
```bash
# 使用手动启动，便于调试
./start_services.sh
```

---

**更新时间**: 2024年6月8日  
**配置状态**: ✅ 已完成域名访问配置 