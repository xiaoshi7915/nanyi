<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å—æ„ç§‹æ£  - æ±‰æ–‡åŒ–å¸ƒæ–™è®¾è®¡</title>
    
    <!-- Vue.js 3 -->
    <script src="static/lib/vue.global.js"></script>
    
    <!-- å¼•å…¥å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="static/lib/all.min.css">
    
    <!-- å¼•å…¥æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="static/css/responsive.css">
    
    <!-- å¼•å…¥ä¼˜åŒ–çš„ç¼“å­˜ç®¡ç†å™¨ -->
    <script>
        /**
         * ä¼˜åŒ–çš„å‰ç«¯ç¼“å­˜ç®¡ç†å™¨
         * é’ˆå¯¹ç¨³å®šçš„å›¾ç‰‡èµ„æºè¿›è¡Œé•¿æœŸç¼“å­˜ï¼Œæå‡æ€§èƒ½
         */
        class OptimizedCacheManager {
            constructor() {
                this.cachePrefix = 'nanyi_cache_';
                this.versionKey = 'nanyi_version';
                this.defaultTTL = 60 * 60 * 1000; // 1å°æ—¶é»˜è®¤ç¼“å­˜æ—¶é—´
                
                // ä¼˜åŒ–çš„ç¼“å­˜ç­–ç•¥ - é’ˆå¯¹ç¨³å®šèµ„æºå»¶é•¿ç¼“å­˜æ—¶é—´
                this.cacheStrategies = {
                    'brands': {
                        ttl: 24 * 60 * 60 * 1000,     // 24å°æ—¶ - å“ç‰Œæ•°æ®ç¨³å®š
                        checkUpdate: false,           // ä¸ä¸»åŠ¨æ£€æŸ¥æ›´æ–°ï¼Œå‡å°‘è¯·æ±‚
                        priority: 'high'              // é«˜ä¼˜å…ˆçº§ç¼“å­˜
                    },
                    'images': {
                        ttl: 24 * 60 * 60 * 1000,    // 24å°æ—¶ - å›¾ç‰‡åˆ—è¡¨å¾ˆç¨³å®š
                        checkUpdate: false,           // ä¸ä¸»åŠ¨æ£€æŸ¥æ›´æ–°
                        priority: 'high'
                    },
                    'filters': {
                        ttl: 12 * 60 * 60 * 1000,    // 12å°æ—¶ - ç­›é€‰é€‰é¡¹å¾ˆå°‘å˜åŒ–
                        checkUpdate: false,
                        priority: 'medium'
                    },
                    'brand_detail': {
                        ttl: 24 * 60 * 60 * 1000,     // 6å°æ—¶ - å“ç‰Œè¯¦æƒ…ç¨³å®š
                        checkUpdate: false,           // ä¸ä¸»åŠ¨æ£€æŸ¥æ›´æ–°
                        priority: 'high'
                    }
                };
                
                this.init();
            }
            
            init() {
                // æ£€æŸ¥åº”ç”¨ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬å˜åŒ–åˆ™æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
                this.checkAppVersion();
                
                // å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆé™ä½é¢‘ç‡ï¼‰
                setInterval(() => {
                    this.cleanExpiredCache();
                }, 5 * 60000); // æ¯5åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
            }
            
            /**
             * æ£€æŸ¥åº”ç”¨ç‰ˆæœ¬ï¼ˆé™ä½æ£€æŸ¥é¢‘ç‡ï¼‰
             */
            checkAppVersion() {
                const currentVersion = this.getAppVersion();
                const cachedVersion = localStorage.getItem(this.versionKey);
                
                if (cachedVersion && cachedVersion !== currentVersion) {
                    console.log('æ£€æµ‹åˆ°åº”ç”¨ç‰ˆæœ¬æ›´æ–°ï¼Œæ¸…ç©ºç¼“å­˜');
                    this.clearAllCache();
                }
                
                localStorage.setItem(this.versionKey, currentVersion);
            }
            
            /**
             * è·å–åº”ç”¨ç‰ˆæœ¬ï¼ˆåŸºäºå½“å‰æ—¶é—´æˆ³çš„å¤©æ•°ï¼Œæ¯å¤©æ£€æŸ¥ä¸€æ¬¡æ›´æ–°ï¼‰
             */
            getAppVersion() {
                return Math.floor(Date.now() / (24 * 60 * 60 * 1000)).toString();
            }
            
            /**
             * ç”Ÿæˆç¼“å­˜é”®
             */
            generateKey(type, identifier = '') {
                return `${this.cachePrefix}${type}_${identifier}`;
            }
            
            /**
             * è®¾ç½®ç¼“å­˜
             */
            set(type, data, identifier = '') {
                const strategy = this.cacheStrategies[type] || { ttl: this.defaultTTL };
                const key = this.generateKey(type, identifier);
                const now = Date.now();
                
                const cacheData = {
                    data: data,
                    timestamp: now,
                    expires: now + strategy.ttl,
                    etag: this.generateETag(data),
                    type: type,
                    priority: strategy.priority || 'medium'
                };
                
                try {
                    localStorage.setItem(key, JSON.stringify(cacheData));
                    console.log(`âœ… ç¼“å­˜å·²è®¾ç½®: ${type} (${identifier}), TTL: ${Math.round(strategy.ttl / 60000)}åˆ†é’Ÿ`);
                } catch (e) {
                    console.warn('ç¼“å­˜è®¾ç½®å¤±è´¥:', e);
                    // å¦‚æœå­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œæ¸…ç†ä½ä¼˜å…ˆçº§ç¼“å­˜
                    this.cleanLowPriorityCache();
                    try {
                        localStorage.setItem(key, JSON.stringify(cacheData));
                    } catch (e2) {
                        console.error('ç¼“å­˜è®¾ç½®æœ€ç»ˆå¤±è´¥:', e2);
                    }
                }
            }
            
            /**
             * è·å–ç¼“å­˜
             */
            get(type, identifier = '') {
                const key = this.generateKey(type, identifier);
                
                try {
                    const cached = localStorage.getItem(key);
                    if (!cached) {
                        return null;
                    }
                    
                    const cacheData = JSON.parse(cached);
                    const now = Date.now();
                    
                    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
                    if (now > cacheData.expires) {
                        console.log(`â° ç¼“å­˜å·²è¿‡æœŸ: ${type} (${identifier})`);
                        localStorage.removeItem(key);
                        return null;
                    }
                    
                    const remainingMinutes = Math.round((cacheData.expires - now) / 60000);
                    console.log(`âœ… ç¼“å­˜å‘½ä¸­: ${type} (${identifier}), å‰©ä½™: ${remainingMinutes}åˆ†é’Ÿ`);
                    return cacheData.data;
                } catch (e) {
                    console.warn('ç¼“å­˜è¯»å–å¤±è´¥:', e);
                    localStorage.removeItem(key);
                    return null;
                }
            }
            
            /**
             * æ™ºèƒ½è·å–æ•°æ®ï¼ˆç¼“å­˜ä¼˜å…ˆï¼Œä¸ä¸»åŠ¨æ›´æ–°ï¼‰
             */
            async getOrFetch(type, fetchFunction, identifier = '') {
                // å…ˆå°è¯•ä»ç¼“å­˜è·å–
                const cached = this.get(type, identifier);
                
                if (cached) {
                    // å¯¹äºç¨³å®šèµ„æºï¼Œç›´æ¥è¿”å›ç¼“å­˜ï¼Œä¸è¿›è¡Œåå°æ›´æ–°
                    return cached;
                }
                
                // ç¼“å­˜æœªå‘½ä¸­ï¼Œç›´æ¥è·å–æ•°æ®
                try {
                    const data = await fetchFunction();
                    if (data) {
                        this.set(type, data, identifier);
                    }
                    return data;
                } catch (e) {
                    console.error('æ•°æ®è·å–å¤±è´¥:', e);
                    throw e;
                }
            }
            
            /**
             * ç”Ÿæˆæ•°æ®çš„ETag
             */
            generateETag(data) {
                const str = JSON.stringify(data);
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
                }
                return hash.toString(36);
            }
            
            /**
             * æ¸…ç†è¿‡æœŸç¼“å­˜
             */
            cleanExpiredCache() {
                const now = Date.now();
                const keysToRemove = [];
                
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith(this.cachePrefix)) {
                        try {
                            const cached = localStorage.getItem(key);
                            const cacheData = JSON.parse(cached);
                            
                            if (now > cacheData.expires) {
                                keysToRemove.push(key);
                            }
                        } catch (e) {
                            keysToRemove.push(key); // æŸåçš„ç¼“å­˜ä¹Ÿåˆ é™¤
                        }
                    }
                }
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                if (keysToRemove.length > 0) {
                    console.log(`ğŸ§¹ æ¸…ç†äº† ${keysToRemove.length} ä¸ªè¿‡æœŸç¼“å­˜`);
                }
            }
            
            /**
             * æ¸…ç†ä½ä¼˜å…ˆçº§ç¼“å­˜
             */
            cleanLowPriorityCache() {
                const cacheItems = [];
                
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith(this.cachePrefix)) {
                        try {
                            const cached = localStorage.getItem(key);
                            const cacheData = JSON.parse(cached);
                            cacheItems.push({
                                key: key,
                                timestamp: cacheData.timestamp,
                                priority: cacheData.priority || 'medium'
                            });
                        } catch (e) {
                            localStorage.removeItem(key);
                        }
                    }
                }
                
                // æŒ‰ä¼˜å…ˆçº§å’Œæ—¶é—´æ’åºï¼Œåˆ é™¤ä½ä¼˜å…ˆçº§çš„æ—§ç¼“å­˜
                cacheItems.sort((a, b) => {
                    const priorityOrder = { 'low': 0, 'medium': 1, 'high': 2 };
                    const aPriority = priorityOrder[a.priority] || 1;
                    const bPriority = priorityOrder[b.priority] || 1;
                    
                    if (aPriority !== bPriority) {
                        return aPriority - bPriority; // ä½ä¼˜å…ˆçº§åœ¨å‰
                    }
                    return a.timestamp - b.timestamp; // æ—§çš„åœ¨å‰
                });
                
                const toDelete = cacheItems.slice(0, Math.floor(cacheItems.length / 3));
                
                toDelete.forEach(item => {
                    localStorage.removeItem(item.key);
                });
                
                console.log(`ğŸ§¹ æ¸…ç†äº† ${toDelete.length} ä¸ªä½ä¼˜å…ˆçº§ç¼“å­˜`);
            }
            
            /**
             * æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
             */
            clearAllCache() {
                const keysToRemove = [];
                
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith(this.cachePrefix)) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                console.log(`ğŸ§¹ æ¸…ç©ºäº†æ‰€æœ‰ç¼“å­˜ (${keysToRemove.length} é¡¹)`);
            }
        }

        // åˆ›å»ºå…¨å±€ä¼˜åŒ–ç¼“å­˜ç®¡ç†å™¨å®ä¾‹
        window.cacheManager = new OptimizedCacheManager();
    </script>
    
    <!-- å¼•å…¥APIå®¢æˆ·ç«¯ -->
    <script src="js/api.js"></script>
    <!-- <script src="js/components.js"></script> -->
    <!-- <script src="static/js/main.js"></script> -->
</head>
<body>
    <div id="app">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <!-- å¯ç‚¹å‡»çš„logoï¼Œè·³è½¬åˆ°æ·˜å®åº—é“º -->
                    <a href="https://shop357296168.taobao.com/?spm=a21n57.shop_search.0.0.1ad93904ohsQt4" 
                       target="_blank" 
                       class="logo-link"
                       @click="handleLogoClick">
                        <div class="logo">
                            <i class="fas fa-leaf"></i>
                            <span>å—æ„ç§‹æ£ </span>
                        </div>
                    </a>
                    <!-- å³ä¾§å›¾æ ‡ -->
                    <div class="header-actions">
                        <a href="https://weidian.com/?userid=1330457134&distributorid=142259736&share_relation=eae4bd30b7458ac1_142259736_1&wfr=h5direct_wxh5" 
                           target="_blank" 
                           class="header-icon" 
                           title="å¾®åº—">
                            <i class="fas fa-store"></i>
                        </a>
                        <button @click="openCustomerService" class="header-icon" title="æ™ºèƒ½å®¢æœ">
                            <i class="fas fa-comments"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- è‹±é›„æ¨ªå¹…åŒº -->
        <section class="hero-banner">
            <div class="container">
                <div class="hero-content">
                    <h1 class="hero-title">ä¼ æ‰¿ç»å…¸ åˆ›æ–°æœªæ¥</h1>
                    <p class="hero-subtitle">æ±‰æ–‡åŒ–å¸ƒæ–™è®¾è®¡çš„è‰ºæœ¯ä¹‹ç¾</p>
                </div>
            </div>
        </section>

        <!-- æœç´¢å’Œç­›é€‰åŒº -->
        <section class="filter-section">
            <div class="container">
                <!-- æœç´¢æ  -->
                <div class="search-box">
                    <div class="search-input-container">
                        <i class="fas fa-search search-icon"></i>
                        <input 
                            v-model="searchQuery" 
                            type="text" 
                            placeholder="æœç´¢å“ç‰Œåç§°ã€å¸ƒæ–™æè´¨ã€ä¸»é¢˜ç³»åˆ—ã€å¹´ä»½..."
                            class="search-input"
                            @input="filterBrands"
                        >
                    </div>
                    <button @click="performSearch" class="search-btn">
                        æœç´¢
                    </button>
                </div>

                <!-- ç§»åŠ¨ç«¯å¹´ä»½æ¨ªæ’ç­›é€‰ -->
                <div class="mobile-only mobile-year-filter">
                    <div class="year-tags-horizontal">
                        <button 
                            @click="clearAllFilters"
                            :class="['year-tag', { active: !hasAnyActiveFilters() }]"
                        >
                            å…¨éƒ¨
                        </button>
                        <button 
                            v-for="year in filterOptions.years" 
                            :key="'mobile-year-' + year"
                            @click="toggleFilter('year', year)"
                            :class="['year-tag', { active: activeFilters.year === year }]"
                        >
                            {{ year }}
                        </button>
                    </div>
                </div>
                
                <!-- æ¡Œé¢ç«¯ç­›é€‰æ ‡ç­¾ -->
                <div class="filter-sections desktop-only">
                    <!-- æŒ‰å¹´ä»½ -->
                    <div class="filter-group">
                        <div class="filter-title">æŒ‰å¹´ä»½</div>
                        <div class="filter-tags-container">
                            <button 
                                @click="clearFilter('year')"
                                :class="['filter-tag', { active: !activeFilters.year }]"
                            >
                                å…¨éƒ¨({{ Object.values(brandData).length }})
                            </button>
                            <button 
                                v-for="year in filterOptions.years" 
                                :key="'year-' + year"
                                @click="toggleFilter('year', year)"
                                :class="['filter-tag', { active: activeFilters.year === year }]"
                            >
                                {{ year }}({{ brandCounts.years[year] || 0 }})
                            </button>
                        </div>
                    </div>

                    <!-- æŒ‰ä¸»é¢˜ç³»åˆ— - ä»…ç”µè„‘ç«¯æ˜¾ç¤º -->
                    <div class="filter-group desktop-only">
                        <div class="filter-title">æŒ‰ä¸»é¢˜ç³»åˆ—</div>
                        <div class="filter-tags-container">
                            <button 
                                @click="clearFilter('theme_series')"
                                :class="['filter-tag', { active: !activeFilters.theme_series }]"
                            >
                                å…¨éƒ¨({{ Object.values(brandData).length }})
                            </button>
                            <button 
                                v-for="series in filterOptions.theme_series" 
                                :key="'series-' + series"
                                @click="toggleFilter('theme_series', series)"
                                :class="['filter-tag', { 
                                    active: (Array.isArray(activeFilters.theme_series) && activeFilters.theme_series.includes(series)) || 
                                           activeFilters.theme_series === series 
                                }]"
                            >
                                {{ series }}({{ brandCounts.theme_series[series] || 0 }})
                            </button>
                        </div>
                    </div>

                    <!-- æŒ‰æè´¨ - ä»…ç”µè„‘ç«¯æ˜¾ç¤º -->
                    <div class="filter-group desktop-only">
                        <div class="filter-title">æŒ‰æè´¨</div>
                        <div class="filter-tags-container">
                            <button 
                                @click="clearFilter('materials')"
                                :class="['filter-tag', { active: !activeFilters.materials }]"
                            >
                                å…¨éƒ¨({{ Object.values(brandData).length }})
                            </button>
                            <button 
                                v-for="material in filterOptions.materials" 
                                :key="'material-' + material"
                                @click="toggleFilter('materials', material)"
                                :class="['filter-tag', { 
                                    active: (Array.isArray(activeFilters.materials) && activeFilters.materials.includes(material)) || 
                                           activeFilters.materials === material 
                                }]"
                            >
                                {{ material }}({{ brandCounts.materials[material] || 0 }})
                            </button>
                        </div>
                    </div>

                    <!-- æŒ‰å°åˆ¶å°ºå¯¸ - ä»…ç”µè„‘ç«¯æ˜¾ç¤º -->
                    <div class="filter-group desktop-only">
                        <div class="filter-title">æŒ‰å°åˆ¶å°ºå¯¸</div>
                        <div class="filter-tags-container">
                            <button 
                                @click="clearFilter('print_sizes')"
                                :class="['filter-tag', { active: !activeFilters.print_sizes }]"
                            >
                                å…¨éƒ¨({{ Object.values(brandData).length }})
                            </button>
                            <button 
                                v-for="size in filterOptions.print_sizes" 
                                :key="'size-' + size"
                                @click="toggleFilter('print_sizes', size)"
                                :class="['filter-tag', { 
                                    active: (Array.isArray(activeFilters.print_sizes) && activeFilters.print_sizes.includes(size)) || 
                                           activeFilters.print_sizes === size 
                                }]"
                            >
                                {{ size }}({{ brandCounts.print_sizes[size] || 0 }})
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ä¸»è¦å†…å®¹ -->
        <main class="main-content">
            <div class="container">
                <!-- åŠ è½½çŠ¶æ€ -->
                <div v-if="loading" class="loading">
                    <div class="spinner"></div>
                    <p>åŠ è½½ä¸­...</p>
                </div>

                <!-- é”™è¯¯çŠ¶æ€ -->
                <div v-else-if="error" class="error-state">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3>åŠ è½½å¤±è´¥</h3>
                    <p>{{ error }}</p>
                    <button @click="loadData" class="retry-btn">é‡è¯•</button>
                </div>

                <!-- å“ç‰Œç½‘æ ¼ -->
                <div v-else-if="filteredBrands.length > 0" class="brands-grid">
                    <div 
                        v-for="brand in filteredBrands" 
                        :key="brand.name"
                        class="brand-card"
                        @click="openBrandDetail(brand)"
                    >
                        <div class="brand-image-container">
                            <img 
                                :src="getBrandCoverImage(brand)" 
                                :alt="brand.name"
                                class="brand-image"
                                loading="lazy"
                                @error="handleImageError"
                            >
                        </div>
                        <div class="brand-info">
                            <h3 class="brand-name">{{ brand.name }}</h3>
                            <div class="brand-meta">
                                <span v-if="brand.year && brand.year !== 'N/A' && brand.year !== ''" 
                                      class="meta-tag" 
                                      @click.stop="filterByTag('year', brand.year)">{{ brand.year }}å¹´</span>
                                <span v-if="brand.theme_series && brand.theme_series !== 'N/A' && brand.theme_series !== ''" 
                                      class="meta-tag" 
                                      @click.stop="filterByTag('theme_series', brand.theme_series)">{{ brand.theme_series }}</span>
                                <span v-if="brand.material && brand.material !== 'N/A' && brand.material !== ''" 
                                      class="meta-tag" 
                                      @click.stop="filterByTag('materials', brand.material)">{{ brand.material }}</span>
                                <span v-if="brand.print_size && brand.print_size !== 'N/A' && brand.print_size !== ''" 
                                      class="meta-tag" 
                                      @click.stop="filterByTag('print_sizes', brand.print_size)">{{ brand.print_size }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç©ºçŠ¶æ€ -->
                <div v-else class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h3>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å“ç‰Œ</h3>
                    <p>å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰é€‰é¡¹</p>
                </div>
            </div>
        </main>

        <!-- å“ç‰Œè¯¦æƒ…æ¨¡æ€æ¡† -->
        <div v-if="selectedBrand && showModal" :class="['modal-overlay', { active: showModal }]" @click="closeModal">
            <div class="modal-content" @click.stop>
                <div class="modal-header">
                    <h2 class="modal-title">{{ selectedBrand.name || selectedBrand.brand_name }}</h2>
                    <button @click="closeModal" class="close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div class="detail-section">
                        <h3 class="section-title">åŸºæœ¬ä¿¡æ¯</h3>
                        <div class="detail-tags">
                            <span v-if="selectedBrand.year && selectedBrand.year !== 'N/A' && selectedBrand.year !== ''" 
                                  class="detail-tag" 
                                  @click="filterByTag('year', selectedBrand.year)">{{ selectedBrand.year }}å¹´</span>
                            <span v-if="selectedBrand.theme_series && selectedBrand.theme_series !== 'N/A' && selectedBrand.theme_series !== ''" 
                                  class="detail-tag" 
                                  @click="filterByTag('theme_series', selectedBrand.theme_series)">{{ selectedBrand.theme_series }}</span>
                            <span v-if="selectedBrand.material && selectedBrand.material !== 'N/A' && selectedBrand.material !== ''" 
                                  class="detail-tag" 
                                  @click="filterByTag('materials', selectedBrand.material)">{{ selectedBrand.material }}</span>
                            <span v-if="selectedBrand.print_size && selectedBrand.print_size !== 'N/A' && selectedBrand.print_size !== ''" 
                                  class="detail-tag" 
                                  @click="filterByTag('print_sizes', selectedBrand.print_size)">{{ selectedBrand.print_size }}</span>
                        </div>
                    </div>

                    <!-- è®¾è®¡çµæ„Ÿ -->
                    <div v-if="selectedBrand.inspiration_origin" class="detail-section">
                        <h3 class="section-title">è®¾è®¡çµæ„Ÿ</h3>
                        <div class="inspiration-text" v-html="formatMarkdown(selectedBrand.inspiration_origin)"></div>
                    </div>

                    <!-- æŒ‰ç±»å‹åˆ†ç±»çš„å›¾ç‰‡å±•ç¤º -->
                    <div v-for="(images, type) in getCategorizedImages()" :key="type" class="detail-section">
                        <h3 class="section-title">{{ type }}</h3>
                        
                        <!-- æŒ‰é¢œè‰²åˆ†ç»„æ˜¾ç¤º -->
                        <div v-for="(colorImages, color) in groupImagesByColor(images)" :key="color" class="color-group">
                            <h4 v-if="Object.keys(groupImagesByColor(images)).length > 1" class="color-title">{{ color }}</h4>
                            <div class="image-gallery">
                                <div 
                                    v-for="image in colorImages" 
                                    :key="image.filename"
                                    class="gallery-item"
                                    @click="openImagePreview(image)"
                                >
                                    <img 
                                        :src="getImageURL(image)" 
                                        :alt="image.filename"
                                        class="gallery-image"
                                        @error="handleImageError"
                                    >
                                    <div class="image-actions">
                                        <button @click.stop="openImagePreview(image)" class="action-btn zoom-btn">
                                            <i class="fas fa-search-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å›¾ç‰‡é¢„è§ˆæ¨¡æ€æ¡† -->
        <div v-if="previewImage" class="image-preview-overlay" @click="closeImagePreview">
            <div class="image-preview-content" @click.stop>
                <button @click="closeImagePreview" class="preview-close-btn">
                    <i class="fas fa-times"></i>
                </button>
                <img 
                    :src="getImageURL(previewImage)" 
                    :alt="previewImage.filename"
                    class="preview-image"
                    @error="handleImageError"
                >
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        const app = createApp({
            data() {
                return {
                    loading: true,
                    error: null,
                    searchQuery: '',
    
                    activeFilters: {
                        year: null,
                        material: null,
                        theme_series: null,
                        print_size: null
                    },
                    filterOptions: {
                        years: [],
                        materials: [],
                        theme_series: [],
                        print_sizes: []
                    },
                    brandCounts: {},
                    currentFilterCounts: {}, // å½“å‰ç­›é€‰çŠ¶æ€ä¸‹çš„æ•°é‡ç»Ÿè®¡
                    allImages: [],
                    brandData: {},
                    filteredBrands: [],
                    selectedBrand: null,
                    brandImages: [],
                    showModal: false,
                    previewImage: null,
                    
                    // ç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®
                    dataLoaded: false
                };
            },
            
            async mounted() {
                try {
                    console.log('Vueåº”ç”¨å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½æ•°æ®...');
                    console.log('å½“å‰URL:', window.location.href);
                    console.log('API Base URL:', window.api ? window.api.baseURL : 'APIæœªåˆå§‹åŒ–');
                    
                    // æ£€æŸ¥APIæ˜¯å¦å¯ç”¨
                    if (!window.api) {
                        console.error('APIå®ä¾‹æœªæ‰¾åˆ°ï¼');
                        this.error = 'APIæœåŠ¡æœªå¯åŠ¨ï¼Œè¯·ç¨åé‡è¯•';
                        this.loading = false;
                        return;
                    }
                    
                    await this.loadData();
                    
                    // ç›‘å¬ç¼“å­˜æ›´æ–°äº‹ä»¶
                    window.addEventListener('cacheDataUpdate', (event) => {
                        const { type, data } = event.detail;
                        if (type === 'brands') {
                            console.log('æ£€æµ‹åˆ°å“ç‰Œæ•°æ®æ›´æ–°ï¼Œåˆ·æ–°ç•Œé¢');
                            this.allImages = data.images || [];
                            this.brandData = {};
                            if (data.brands) {
                                data.brands.forEach(brand => {
                                    this.brandData[brand.name] = brand;
                                });
                                this.filteredBrands = data.brands;
                                this.generateFilterOptions();
                                this.filterBrands(); // é‡æ–°åº”ç”¨ç­›é€‰
                            }
                        }
                    });
                } catch (error) {
                    console.error('Vueåº”ç”¨æŒ‚è½½å¤±è´¥:', error);
                    this.error = 'åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
                    this.loading = false;
                }
            },

            computed: {
                // å·²ç§»é™¤hasActiveFiltersè®¡ç®—å±æ€§ï¼Œå› ä¸ºä¸å†éœ€è¦æ¸…é™¤ç­›é€‰åŠŸèƒ½
            },

            watch: {
                searchQuery() {
                    this.filterBrands();
                }
            },

            methods: {
                async loadData() {
                    this.loading = true;
                    this.error = null;
                    
                    try {
                        console.log('å¼€å§‹åŠ è½½æ•°æ®...');
                        
                        // ä½¿ç”¨æ™ºèƒ½ç¼“å­˜ç®¡ç†å™¨
                        const cachedData = await window.cacheManager.getOrFetch(
                            'brands',
                            async () => {
                                console.log('ä»APIè·å–æ•°æ®...');
                                // æ·»åŠ é‡è¯•æœºåˆ¶
                                for (let retry = 0; retry < 3; retry++) {
                                    try {
                                        const response = await window.api.getImages();
                                        if (response && response.success) {
                                            return {
                                                images: response.images || [],
                                                brands: response.brands || []
                                            };
                                        }
                                        throw new Error('APIå“åº”æ— æ•ˆ');
                                    } catch (apiError) {
                                        console.warn(`APIè¯·æ±‚å¤±è´¥ (å°è¯• ${retry + 1}/3):`, apiError);
                                        if (retry === 2) {
                                            throw apiError;
                                        }
                                        await new Promise(resolve => setTimeout(resolve, 1000));
                                    }
                                }
                            }
                        );
                        
                        if (cachedData) {
                            this.allImages = cachedData.images || [];
                            this.brandData = {};
                            
                            if (cachedData.brands && cachedData.brands.length > 0) {
                                cachedData.brands.forEach(brand => {
                                    this.brandData[brand.name] = brand;
                                });
                                this.filteredBrands = cachedData.brands;
                                this.generateFilterOptions();
                            } else if (this.allImages.length > 0) {
                                console.log('ä½¿ç”¨å›¾ç‰‡æ•°æ®å¤„ç†å“ç‰Œä¿¡æ¯');
                                this.processBrandData();
                            } else {
                                throw new Error('æ²¡æœ‰è·å–åˆ°æœ‰æ•ˆçš„æ•°æ®');
                            }
                            
                            this.dataLoaded = true;
                            console.log('æ•°æ®åŠ è½½å®Œæˆ');
                        } else {
                            throw new Error('æ•°æ®åŠ è½½å¤±è´¥');
                        }

                    } catch (error) {
                        console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                        
                        // è®¾ç½®å‹å¥½çš„é”™è¯¯ä¿¡æ¯
                        if (error.message.includes('ç½‘ç»œ') || error.message.includes('è¿æ¥')) {
                            this.error = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                        } else if (error.message.includes('API')) {
                            this.error = 'APIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•';
                        } else {
                            this.error = error.message || 'åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
                        }
                        
                        // ç¡®ä¿æœ‰ä¸€äº›é»˜è®¤æ•°æ®æ˜¾ç¤ºï¼Œé¿å…å®Œå…¨ç©ºç™½
                        if (!this.filteredBrands || this.filteredBrands.length === 0) {
                            this.filteredBrands = [];
                            this.brandData = {};
                        }
                    } finally {
                        this.loading = false;
                    }
                },

                generateFilterOptions() {
                    // ä»å“ç‰Œæ•°æ®ä¸­æå–å”¯ä¸€çš„ç­›é€‰é€‰é¡¹å¹¶ç»Ÿè®¡æ•°é‡
                    const yearCounts = {};
                    const materialCounts = {};
                    const themeSeriesCounts = {};
                    const printSizeCounts = {};
                    
                    Object.values(this.brandData).forEach(brand => {
                        if (brand.year) {
                            const year = brand.year.toString();
                            yearCounts[year] = (yearCounts[year] || 0) + 1;
                        }
                        if (brand.material) {
                            materialCounts[brand.material] = (materialCounts[brand.material] || 0) + 1;
                        }
                        if (brand.theme_series) {
                            themeSeriesCounts[brand.theme_series] = (themeSeriesCounts[brand.theme_series] || 0) + 1;
                        }
                        if (brand.print_size) {
                            printSizeCounts[brand.print_size] = (printSizeCounts[brand.print_size] || 0) + 1;
                        }
                    });
                    
                    // ç”Ÿæˆå¸¦ç»Ÿè®¡æ•°é‡çš„é€‰é¡¹ï¼ˆä¸åŒ…å«"å…¨éƒ¨"ï¼‰
                    this.filterOptions = {
                        years: Object.keys(yearCounts).sort((a, b) => b.localeCompare(a)),
                        materials: Object.keys(materialCounts).sort(),
                        theme_series: Object.keys(themeSeriesCounts).sort(),
                        print_sizes: Object.keys(printSizeCounts).sort()
                    };
                    
                    // ä¿å­˜ç»Ÿè®¡æ•°é‡
                    this.brandCounts = {
                        years: yearCounts,
                        materials: materialCounts,
                        theme_series: themeSeriesCounts,
                        print_sizes: printSizeCounts
                    };
                    
                    console.log('åŠ¨æ€ç”Ÿæˆçš„ç­›é€‰é€‰é¡¹:', this.filterOptions);
                    console.log('ç»Ÿè®¡æ•°é‡:', this.brandCounts);
                },

                processBrandData() {
                    const brands = {};
                    
                    this.allImages.forEach(image => {
                        const brandName = image.brand_name;
                        

                        
                        if (!brands[brandName]) {
                            brands[brandName] = {
                                name: brandName,
                                images: [],
                                year: image.year || null,
                                material: image.material || null,
                                theme_series: image.theme_series || null,
                                print_size: image.print_size || null,
                                inspiration_origin: image.inspiration_origin || `${brandName}çš„è®¾è®¡çµæ„Ÿæ¥æºäºä¼ ç»Ÿæ–‡åŒ–ä¸ç°ä»£ç¾å­¦çš„èåˆã€‚`
                            };
                        }
                        brands[brandName].images.push(image);
                    });

                    this.brandData = brands;
                    this.filteredBrands = Object.values(brands);
                    
                    // ç”Ÿæˆç­›é€‰é€‰é¡¹
                    this.generateFilterOptions();
                },

                filterBrands() {
                    let filtered = Object.values(this.brandData);

                    // æœç´¢è¿‡æ»¤ - æ”¯æŒå¤šå­—æ®µæœç´¢
                    if (this.searchQuery.trim()) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(brand => 
                            brand.name.toLowerCase().includes(query) ||
                            (brand.material && brand.material.toLowerCase().includes(query)) ||
                            (brand.theme_series && brand.theme_series.toLowerCase().includes(query)) ||
                            (brand.print_size && brand.print_size.toLowerCase().includes(query)) ||
                            (brand.year && brand.year.toString().includes(query))
                        );
                    }

                    // ç­›é€‰è¿‡æ»¤
                    Object.keys(this.activeFilters).forEach(key => {
                        const value = this.activeFilters[key];
                        if (value && value !== null && value !== undefined) {
                            // æ˜ å°„å‰ç«¯å­—æ®µååˆ°æ•°æ®å­—æ®µå
                            const fieldMap = {
                                'materials': 'material',
                                'print_sizes': 'print_size'
                            };
                            const fieldName = fieldMap[key] || key;
                            
                            if (Array.isArray(value) && value.length > 0) {
                                // å¤šé€‰æ¨¡å¼ï¼šå“ç‰Œå¿…é¡»åŒ¹é…ä»»ä¸€é€‰ä¸­çš„å€¼
                                filtered = filtered.filter(brand => 
                                    brand[fieldName] && value.includes(brand[fieldName])
                                );
                            } else if (!Array.isArray(value)) {
                                // å•é€‰æ¨¡å¼ï¼šå“ç‰Œå¿…é¡»åŒ¹é…é€‰ä¸­çš„å€¼
                                if (fieldName === 'year') {
                                    // å¹´ä»½ç­›é€‰ç‰¹æ®Šå¤„ç†
                                    filtered = filtered.filter(brand => 
                                        brand[fieldName] && brand[fieldName].toString() === value.toString()
                                    );
                                } else {
                                    filtered = filtered.filter(brand => 
                                        brand[fieldName] && brand[fieldName] === value
                                    );
                                }
                            }
                        }
                    });

                    this.filteredBrands = filtered;
                    
                    // æ›´æ–°ç­›é€‰åçš„ç»Ÿè®¡æ•°é‡
                    this.updateFilterCounts(filtered);
                },
                
                // æ›´æ–°ç­›é€‰åçš„ç»Ÿè®¡æ•°é‡
                updateFilterCounts(filteredBrands) {
                    const yearCounts = {};
                    const materialCounts = {};
                    const themeSeriesCounts = {};
                    const printSizeCounts = {};
                    
                    // é‡æ–°è®¡ç®—å½“å‰ç­›é€‰ç»“æœä¸­çš„æ•°é‡
                    filteredBrands.forEach(brand => {
                        if (brand.year) {
                            const year = brand.year.toString();
                            yearCounts[year] = (yearCounts[year] || 0) + 1;
                        }
                        if (brand.material) {
                            materialCounts[brand.material] = (materialCounts[brand.material] || 0) + 1;
                        }
                        if (brand.theme_series) {
                            themeSeriesCounts[brand.theme_series] = (themeSeriesCounts[brand.theme_series] || 0) + 1;
                        }
                        if (brand.print_size) {
                            printSizeCounts[brand.print_size] = (printSizeCounts[brand.print_size] || 0) + 1;
                        }
                    });
                    
                    // æ›´æ–°å½“å‰ç­›é€‰çŠ¶æ€ä¸‹çš„æ•°é‡ç»Ÿè®¡
                    this.currentFilterCounts = {
                        years: yearCounts,
                        materials: materialCounts,
                        theme_series: themeSeriesCounts,
                        print_sizes: printSizeCounts
                    };
                },

                toggleFilter(type, value) {
                    // æ”¯æŒå¤šé€‰çš„ç­›é€‰ç±»å‹
                    const multiSelectTypes = ['materials', 'theme_series', 'print_sizes'];
                    
                    if (multiSelectTypes.includes(type)) {
                        // å¤šé€‰æ¨¡å¼ï¼šå¯ä»¥åŒæ—¶é€‰æ‹©å¤šä¸ªå€¼
                        if (!this.activeFilters[type]) {
                            this.activeFilters[type] = [];
                        }
                        
                        const index = this.activeFilters[type].indexOf(value);
                        if (index > -1) {
                            this.activeFilters[type].splice(index, 1);
                            if (this.activeFilters[type].length === 0) {
                                this.activeFilters[type] = null;
                            }
                        } else {
                            this.activeFilters[type].push(value);
                        }
                    } else {
                        // å•é€‰æ¨¡å¼ï¼šå¹´ä»½åªèƒ½é€‰æ‹©ä¸€ä¸ª
                        if (this.activeFilters[type] === value) {
                            this.activeFilters[type] = null;
                        } else {
                            this.activeFilters[type] = value;
                        }
                    }
                    
                    this.filterBrands();
                },

                clearAllFilters() {
                    this.activeFilters = {
                        year: null,
                        materials: null,
                        theme_series: null,
                        print_sizes: null
                    };
                    this.filterBrands();
                },

                getBrandCoverImage(brand) {
                    // åªæ˜¾ç¤ºè®¾è®¡å›¾
                    const designImage = brand.images.find(img => img.image_type === 'è®¾è®¡å›¾');
                    if (designImage) {
                        // ä½¿ç”¨å‰ç«¯é™æ€æ–‡ä»¶è·¯å¾„ï¼Œæ­£ç¡®ç¼–ç ä¸­æ–‡å­—ç¬¦
                        const encodedPath = designImage.relative_path.split('/').map(part => encodeURIComponent(part)).join('/');
                        return `/static/images/${encodedPath}`;
                    }
                    // å¦‚æœæ²¡æœ‰è®¾è®¡å›¾ï¼Œå°è¯•ä½¿ç”¨å…¶ä»–å›¾ç‰‡
                    if (brand.images.length > 0) {
                        const encodedPath = brand.images[0].relative_path.split('/').map(part => encodeURIComponent(part)).join('/');
                        return `/static/images/${encodedPath}`;
                    }
                    return null;
                },

                async openBrandDetail(brand) {
                    console.log('æ‰“å¼€å“ç‰Œè¯¦æƒ…:', brand);
                    
                    // ä½¿ç”¨æ™ºèƒ½ç¼“å­˜ç®¡ç†å™¨è·å–å“ç‰Œè¯¦æƒ…
                    const brandDetail = await window.cacheManager.getOrFetch(
                        'brand_detail',
                        async () => {
                            console.log('ä»APIè·å–å“ç‰Œè¯¦æƒ…...');
                            try {
                                const response = await window.api.getBrandDetail(brand.name);
                                if (response && response.success && response.images) {
                                    return {
                                        brand_info: response.brand_info,
                                        images: response.images
                                    };
                                }
                            } catch (error) {
                                console.warn('APIè·å–å“ç‰Œè¯¦æƒ…å¤±è´¥:', error);
                            }
                            
                            // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®
                            return {
                                brand_info: brand,
                                images: brand.images || []
                            };
                        },
                        brand.name
                    );
                    
                    // è®¾ç½®å“ç‰Œè¯¦æƒ…æ•°æ®
                    this.selectedBrand = brandDetail.brand_info;
                    this.brandImages = brandDetail.images;
                    
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    this.showModal = true;
                    document.body.style.overflow = 'hidden';
                },

                closeModal() {
                    this.showModal = false;
                    document.body.style.overflow = 'auto';
                    setTimeout(() => {
                        this.selectedBrand = null;
                        this.brandImages = [];
                    }, 300);
                },

                getCategorizedImages() {
                    if (!this.selectedBrand || !this.selectedBrand.images) {
                        return {};
                    }
                    
                    const categories = {};
                    
                    this.selectedBrand.images.forEach(img => {
                        // ä»æ–‡ä»¶åä¸­æå–å›¾ç‰‡ç±»å‹
                        let type = 'å…¶ä»–';
                        if (img.filename.includes('-è®¾è®¡å›¾-') || img.filename.includes('è®¾è®¡å›¾')) {
                            type = 'è®¾è®¡å›¾';
                        } else if (img.filename.includes('-å¸ƒæ–™å›¾-') || img.filename.includes('å¸ƒæ–™å›¾')) {
                            type = 'å¸ƒæ–™å›¾';
                        } else if (img.filename.includes('-æˆè¡£å›¾-') || img.filename.includes('æˆè¡£å›¾')) {
                            type = 'æˆè¡£å›¾';
                        } else if (img.filename.includes('-æ¨¡ç‰¹å›¾-') || img.filename.includes('æ¨¡ç‰¹å›¾')) {
                            type = 'æ¨¡ç‰¹å›¾';
                        } else if (img.filename.includes('-ä¹°å®¶ç§€-') || img.filename.includes('ä¹°å®¶ç§€')) {
                            type = 'ä¹°å®¶ç§€';
                        }
                        
                        if (!categories[type]) {
                            categories[type] = [];
                        }
                        categories[type].push(img);
                    });
                    
                    // æŒ‰é¢„å®šä¹‰é¡ºåºæ’åº
                    const orderedCategories = {};
                    const order = ['è®¾è®¡å›¾', 'å¸ƒæ–™å›¾', 'æˆè¡£å›¾', 'æ¨¡ç‰¹å›¾', 'ä¹°å®¶ç§€', 'å…¶ä»–'];
                    
                    order.forEach(type => {
                        if (categories[type] && categories[type].length > 0) {
                            orderedCategories[type] = categories[type];
                        }
                    });
                    
                    return orderedCategories;
                },

                groupImagesByColor(images) {
                    if (!images || images.length === 0) {
                        return {};
                    }
                    
                    const colorGroups = {};
                    
                    images.forEach(img => {
                        // ä»æ–‡ä»¶åä¸­æå–é¢œè‰²ä¿¡æ¯
                        let color = 'é»˜è®¤è‰²';
                        const filename = img.filename;
                        
                        // åŒ¹é…æ‹¬å·ä¸­çš„é¢œè‰²ä¿¡æ¯
                        const colorMatch = filename.match(/\(([^)]+)\)/);
                        if (colorMatch) {
                            color = colorMatch[1];
                        }
                        
                        if (!colorGroups[color]) {
                            colorGroups[color] = [];
                        }
                        colorGroups[color].push(img);
                    });
                    
                    // æŒ‰æ–‡ä»¶åç¼–å·æ’åº
                    Object.keys(colorGroups).forEach(color => {
                        colorGroups[color].sort((a, b) => {
                            const aNum = parseInt(a.filename.match(/-(\d+)\./)?.[1] || '0');
                            const bNum = parseInt(b.filename.match(/-(\d+)\./)?.[1] || '0');
                            return aNum - bNum;
                        });
                    });
                    
                    return colorGroups;
                },

                getDesignImages() {
                    return this.brandImages.filter(img => img.image_type === 'è®¾è®¡å›¾');
                },

                getFabricImages() {
                    return this.brandImages.filter(img => img.image_type === 'å¸ƒæ–™å›¾');
                },

                getImageURL(image) {
                    // ä½¿ç”¨å‰ç«¯é™æ€æ–‡ä»¶è·¯å¾„ï¼Œæ­£ç¡®ç¼–ç ä¸­æ–‡å­—ç¬¦
                    const encodedPath = image.relative_path.split('/').map(part => encodeURIComponent(part)).join('/');
                    return `/static/images/${encodedPath}`;
                },

                shareCard() {
                    try {
                        const brandName = this.selectedBrand.name || this.selectedBrand.brand_name || 'æœªçŸ¥å“ç‰Œ';
                        const shareData = {
                            title: `å—æ„ç§‹æ£  - ${brandName}`,
                            text: `æŸ¥çœ‹è¿™ä¸ªæ¼‚äº®çš„æ±‰æ–‡åŒ–å¸ƒæ–™è®¾è®¡ï¼š${brandName}`,
                            url: window.location.href
                        };

                        if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
                            navigator.share(shareData).catch(err => {
                                console.log('åˆ†äº«å¤±è´¥:', err);
                                this.fallbackShare();
                            });
                        } else {
                            this.fallbackShare();
                        }
                    } catch (error) {
                        console.error('åˆ†äº«é”™è¯¯:', error);
                        this.fallbackShare();
                    }
                },

                fallbackShare() {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(window.location.href).then(() => {
                            alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨åˆ†äº«');
                        }).catch(() => {
                            this.showShareOptions();
                        });
                    } else {
                        this.showShareOptions();
                    }
                },

                showShareOptions() {
                    const brandName = this.selectedBrand.name || this.selectedBrand.brand_name || 'æœªçŸ¥å“ç‰Œ';
                    const message = `å—æ„ç§‹æ£  - ${brandName}\n${window.location.href}`;
                    
                    // å°è¯•æ‰“å¼€å¾®ä¿¡åˆ†äº«ï¼ˆä»…åœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­æœ‰æ•ˆï¼‰
                    if (/MicroMessenger/i.test(navigator.userAgent)) {
                        alert('è¯·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«æŒ‰é’®åˆ†äº«åˆ°å¾®ä¿¡');
                    } else {
                        // åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡æœ¬åŒºåŸŸæ¥å¤åˆ¶æ–‡æœ¬
                        const textArea = document.createElement('textarea');
                        textArea.value = message;
                        document.body.appendChild(textArea);
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            alert('åˆ†äº«å†…å®¹å·²å¤åˆ¶ï¼Œæ‚¨å¯ä»¥ç²˜è´´åˆ°å¾®ä¿¡æˆ–å…¶ä»–å¹³å°åˆ†äº«');
                        } catch (err) {
                            alert(`è¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ†äº«ï¼š\n${message}`);
                        }
                        document.body.removeChild(textArea);
                    }
                },

                handleImageError(event) {
                    // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶éšè—å›¾ç‰‡
                    event.target.style.display = 'none';
                },

                openImagePreview(image) {
                    this.previewImage = image;
                    document.body.style.overflow = 'hidden';
                },

                closeImagePreview() {
                    this.previewImage = null;
                    document.body.style.overflow = 'auto';
                },

                downloadImage(image) {
                    const link = document.createElement('a');
                    link.href = this.getImageURL(image);
                    link.download = image.filename || 'image.jpg';
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                },

                openCustomerService() {
                    // æ™ºèƒ½å®¢æœåŠŸèƒ½
                    const wechatId = 'LPumpkin0217';
                    const qqNumber = '502517787';

                    // åˆ›å»ºå®¢æœé€‰æ‹©å¼¹çª—
                    const modal = document.createElement('div');
                    modal.className = 'customer-service-modal';
                    modal.innerHTML = `
                        <div class="customer-service-overlay" onclick="this.parentElement.remove()">
                            <div class="customer-service-content" onclick="event.stopPropagation()">
                                <div class="customer-service-header">
                                    <h3>è”ç³»å®¢æœ</h3>
                                    <button onclick="this.closest('.customer-service-modal').remove()" class="close-btn">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="customer-service-options">
                                    <div class="service-option" onclick="window.copyToClipboard('${wechatId}', 'å¾®ä¿¡å·')">
                                        <div class="service-icon">
                                            <i class="fab fa-weixin"></i>
                                        </div>
                                        <div class="service-info">
                                            <div class="service-name">å¾®ä¿¡å®¢æœ</div>
                                            <div class="service-id">${wechatId}</div>
                                        </div>
                                        <div class="copy-hint">ç‚¹å‡»å¤åˆ¶</div>
                                    </div>
                                    <div class="service-option" onclick="window.copyToClipboard('${qqNumber}', 'QQå·')">
                                        <div class="service-icon">
                                            <i class="fab fa-qq"></i>
                                        </div>
                                        <div class="service-info">
                                            <div class="service-name">QQå®¢æœ</div>
                                            <div class="service-id">${qqNumber}</div>
                                        </div>
                                        <div class="copy-hint">ç‚¹å‡»å¤åˆ¶</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    // æ·»åŠ æ ·å¼
                    const style = document.createElement('style');
                    style.textContent = `
                        .customer-service-modal {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            z-index: 10000;
                        }
                        .customer-service-overlay {
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0,0,0,0.5);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }
                        .customer-service-content {
                            background: white;
                            border-radius: 12px;
                            padding: 0;
                            max-width: 400px;
                            width: 90%;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                        }
                        .customer-service-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 1rem;
                            border-bottom: 1px solid #eee;
                        }
                        .customer-service-header h3 {
                            margin: 0;
                            color: #333;
                            font-size: 1.1rem;
                        }
                        .customer-service-options {
                            padding: 1rem;
                            display: flex;
                            flex-direction: column;
                            gap: 0.8rem;
                        }
                        .service-option {
                            display: flex;
                            align-items: center;
                            gap: 0.8rem;
                            padding: 0.8rem;
                            border: 2px solid #e5e7eb;
                            border-radius: 8px;
                            background: white;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-size: 0.9rem;
                        }
                        @media (max-width: 768px) {
                            .customer-service-content {
                                max-width: 320px;
                                width: 85%;
                            }
                            .customer-service-header {
                                padding: 0.8rem;
                            }
                            .customer-service-header h3 {
                                font-size: 1rem;
                            }
                            .customer-service-options {
                                padding: 0.8rem;
                                gap: 0.6rem;
                            }
                            .service-option {
                                gap: 0.6rem;
                                padding: 0.6rem;
                                font-size: 0.85rem;
                            }
                            .service-icon i {
                                font-size: 1.2rem !important;
                            }
                            .service-name {
                                font-size: 0.85rem;
                            }
                            .service-id {
                                font-size: 0.8rem;
                            }
                            .copy-hint {
                                font-size: 0.7rem;
                                padding: 0.2rem 0.4rem;
                            }
                        }
                        .service-option:hover {
                            border-color: #667eea;
                            background: #f8f9ff;
                            transform: translateY(-2px);
                        }
                        .service-icon i {
                            font-size: 1.5rem;
                            color: #667eea;
                        }
                        .service-info {
                            flex: 1;
                            text-align: left;
                        }
                        .service-name {
                            font-weight: 600;
                            color: #333;
                            margin-bottom: 0.25rem;
                        }
                        .service-id {
                            color: #667eea;
                            font-family: monospace;
                            font-size: 0.9rem;
                        }
                        .copy-hint {
                            color: #999;
                            font-size: 0.8rem;
                            background: #f3f4f6;
                            padding: 0.25rem 0.5rem;
                            border-radius: 4px;
                        }
                    `;

                    document.head.appendChild(style);
                    document.body.appendChild(modal);
                    
                    // è®¾ç½®å…¨å±€å¤åˆ¶å‡½æ•°
                    window.copyToClipboard = this.copyToClipboard;
                },

                // å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
                copyToClipboard(text, type) {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(text).then(() => {
                            alert(`${type}å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š${text}`);
                        }).catch(() => {
                            this.fallbackCopyTextToClipboard(text, type);
                        });
                    } else {
                        this.fallbackCopyTextToClipboard(text, type);
                    }
                },

                // é™çº§å¤åˆ¶æ–¹æ¡ˆ
                fallbackCopyTextToClipboard(text, type) {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            alert(`${type}å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š${text}`);
                        } else {
                            alert(`å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š${text}`);
                        }
                    } catch (err) {
                        alert(`å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š${text}`);
                    }
                    
                    document.body.removeChild(textArea);
                },

                // å¤„ç†logoç‚¹å‡»
                handleLogoClick(event) {
                    // ç§»åŠ¨ç«¯ç›´æ¥è·³è½¬ï¼Œä¸é˜»æ­¢é»˜è®¤è¡Œä¸º
                    if (window.innerWidth <= 768) {
                        // ç§»åŠ¨ç«¯ï¼šç›´æ¥è·³è½¬
                        window.open('https://shop357296168.taobao.com/?spm=a21n57.shop_search.0.0.1ad93904ohsQt4', '_blank');
                        event.preventDefault(); // é˜»æ­¢é»˜è®¤çš„aæ ‡ç­¾è¡Œä¸ºï¼Œä½¿ç”¨æˆ‘ä»¬çš„è·³è½¬
                    }
                    // æ¡Œé¢ç«¯ï¼šä½¿ç”¨é»˜è®¤çš„aæ ‡ç­¾è¡Œä¸º
                },

                // é€šè¿‡æ ‡ç­¾ç­›é€‰å“ç‰Œ
                filterByTag(filterType, filterValue) {
                    console.log(`ç‚¹å‡»ç­›é€‰: ${filterType} = ${filterValue}`);
                    
                    // å…³é—­æ¨¡æ€æ¡†ï¼ˆå¦‚æœæ˜¯ä»è¯¦æƒ…é¡µç‚¹å‡»çš„ï¼‰
                    if (this.showModal) {
                        this.closeModal();
                    }
                    
                    // æ¸…é™¤æœç´¢æ¡†å†…å®¹
                    this.searchQuery = '';
                    
                    // æ”¯æŒæ ‡ç­¾çš„toggleåŠŸèƒ½
                    if (filterType === 'year') {
                        // å¹´ä»½æ˜¯å•é€‰ï¼Œç‚¹å‡»ç›¸åŒå€¼åˆ™å–æ¶ˆ
                        if (this.activeFilters[filterType] === filterValue) {
                            this.activeFilters[filterType] = null;
                        } else {
                            this.activeFilters[filterType] = filterValue;
                        }
                    } else {
                        // å¤šé€‰ç±»å‹æ”¯æŒç»„åˆç­›é€‰
                        if (!this.activeFilters[filterType]) {
                            this.activeFilters[filterType] = [];
                        }
                        
                        const index = this.activeFilters[filterType].indexOf(filterValue);
                        if (index > -1) {
                            // å·²å­˜åœ¨ï¼Œç§»é™¤
                            this.activeFilters[filterType].splice(index, 1);
                            if (this.activeFilters[filterType].length === 0) {
                                this.activeFilters[filterType] = null;
                            }
                        } else {
                            // ä¸å­˜åœ¨ï¼Œæ·»åŠ 
                            this.activeFilters[filterType].push(filterValue);
                        }
                    }
                    
                    // åº”ç”¨ç­›é€‰
                    this.filterBrands();
                    
                    // æ»šåŠ¨åˆ°ç­›é€‰åŒºåŸŸ
                    const filterSection = document.querySelector('.filter-section');
                    if (filterSection) {
                        filterSection.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                    }
                },

                // æ¸…é™¤å•ä¸ªç­›é€‰æ¡ä»¶
                clearFilter(filterType) {
                    console.log(`æ¸…é™¤ç­›é€‰: ${filterType}`);
                    
                    // æ¸…é™¤æŒ‡å®šçš„ç­›é€‰æ¡ä»¶
                    this.activeFilters[filterType] = null;
                    
                    // åº”ç”¨ç­›é€‰
                    this.filterBrands();
                },

                // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•æ´»è·ƒçš„ç­›é€‰æ¡ä»¶
                hasAnyActiveFilters() {
                    return Object.values(this.activeFilters).some(filter => 
                        filter !== null && 
                        filter !== undefined && 
                        (Array.isArray(filter) ? filter.length > 0 : true)
                    );
                },

                // ç®€å•çš„Markdownæ ¼å¼åŒ–
                formatMarkdown(text) {
                    if (!text) return '';
                    
                    return text
                        // ç²—ä½“ **text** æˆ– __text__
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/__(.*?)__/g, '<strong>$1</strong>')
                        // æ–œä½“ *text* æˆ– _text_
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/_(.*?)_/g, '<em>$1</em>')
                        // æ¢è¡Œ
                        .replace(/\n/g, '<br>')
                        // æ®µè½åˆ†éš”
                        .replace(/\n\n/g, '</p><p>')
                        // åŒ…è£…åœ¨æ®µè½ä¸­
                        .replace(/^(.+)$/, '<p>$1</p>');
                }
            }
        });

        // å…¨å±€é”™è¯¯å¤„ç†
        app.config.errorHandler = (err, instance, info) => {
            console.error('Vueå…¨å±€é”™è¯¯:', err);
            console.error('é”™è¯¯ä¿¡æ¯:', info);
            console.error('ç»„ä»¶å®ä¾‹:', instance);
        };

        // æŒ‚è½½åº”ç”¨
        try {
            app.mount('#app');
            console.log('Vueåº”ç”¨æŒ‚è½½æˆåŠŸ');
        } catch (error) {
            console.error('Vueåº”ç”¨æŒ‚è½½å¤±è´¥:', error);
            document.getElementById('app').innerHTML = `
                <div style="text-align: center; padding: 50px; color: #666;">
                    <h3>åº”ç”¨åŠ è½½å¤±è´¥</h3>
                    <p>è¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
                    <button onclick="location.reload()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        åˆ·æ–°é¡µé¢
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html> 